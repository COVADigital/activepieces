<div class="item-container ap-flex ap-items-center" (mouseenter)="this.hover = true" (mouseleave)="this.hover = false"
  [style]="
    (hover && clickable
      ? '  background: #FAFAFA; '
      : '  background: #FFFFFF; ') + (clickable ? 'cursor: pointer;' : '')
  ">
  <ng-container *ngIf="_flowItemDetails; else observableFlowItemDetails">
    <ng-container *ngTemplateOutlet="
        flowItemDetailsBody;
        context: { $implicit: _flowItemDetails }
      "></ng-container>
  </ng-container>
  <ng-template #observableFlowItemDetails>
    <ng-container *ngIf="_flowItemDetails$ | async as detailsResult;else loading">
      <ng-container *ngTemplateOutlet="
        flowItemDetailsBody;
        context: { $implicit: detailsResult }
      "></ng-container>
    </ng-container>
  </ng-template>
</div>

<ng-template #flowItemDetailsBody let-itemDetails>
  <div class="logo-container ap-relative ap-flex ">
    <div *ngIf="!stepIconUrl" class="ap-flex-grow ap-flex ap-items-center ap-justify-center ">
      <div class="spinner-grow ap-text-primary ">
        <span class="sr-only">...</span>
      </div>
    </div>

    <img *ngIf="stepIconUrl" @fadeIn class="type-logo" [src]="stepIconUrl" />
  </div>
  <div class="type-text-container   ap-flex-grow ap-flex ap-items-center ap-gap-0.5 ap-justify-between">
    <div>
      <div class="type-label">{{ itemDetails.name }}</div>
      <div *ngIf="!clickable" class="description">{{ itemDetails.description }}</div>

      <mat-chip-listbox *ngIf="clickable">
        <ng-container *ngFor="let actionOrTrigger of (itemDetails?.actionsOrTriggers | slicer:0:3); let isLast=last">
          <mat-chip-option (click)="actionOrTirggerClicked.emit(actionOrTrigger)" color="primary-light"
            [highlighted]="true"> {{actionOrTrigger.displayName}}</mat-chip-option>
        </ng-container>
      </mat-chip-listbox>
    </div>
    <!-- <ng-container *ngIf="clickable && itemDetails.extra?.actionsOrTriggers.length > 3">
      <ng-container *ngTemplateOutlet="
      triggersOrActionsList;
      context: { $implicit: itemDetails }
    "></ng-container>
    </ng-container> -->
  </div>
</ng-template>

<ng-template #loading>
  <div class="ap-flex ap-items-center ap-justify-center ap-flex-grow loading-container">
    <ap-loading-icon></ap-loading-icon>
  </div>
</ng-template>
<ng-template #triggersOrActionsList let-itemDetails>
  <ap-icon-button iconFilename="dropdown.svg" [width]="22" [height]="22" (click)="$event.stopImmediatePropagation()"
    [matMenuTriggerFor]="menu">
  </ap-icon-button>


  <mat-menu #menu="matMenu" xPosition="before">
    <button mat-menu-item *ngFor="let actionOrTrigger of itemDetails.extra?.actionsOrTriggers"
      (click)="actionOrTirggerClicked.emit(actionOrTrigger)">
      {{
      actionOrTrigger.displayName
      }}
    </button>
  </mat-menu>
</ng-template>